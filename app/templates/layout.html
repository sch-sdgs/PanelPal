<!DOCTYPE html>
<html>
<head>
    <title>PanelPal</title>
    <link rel="shortcut icon" href="/favicon.ico}" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
    <!--<script src="/static/js/bootstrap.min.js"></script>-->
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>

    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <!--<link rel="stylesheet" href="/static/css/bootstrap-theme.min.css">-->
    <link rel="stylesheet" href="/static/css/panel_pal.css">

    <!-- Latest compiled JavaScript -->
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">

    <script>
        $(document).on('click', '.glyphicon', function (j) {

            console.log($('#vpanelname').val());
            console.log($('#vpanelname').val().length);

            if($('.glyphicon-new-selected').attr('href') == '#initialise')
            {

                console.log($('#vpanelname').val());
                console.log($('#vpanelname').val().length);

                if($('#panel').val() == '__None' || $('#vpanelname').val().length == 0)
                {
                    j.preventDefault()
                    console.log('empty field');
                    return;
                }
                else
                {
                    console.log('hello');
                    var vp_name = $('#vpanelname').val()
                    var dict = {
                                "vp_name": vp_name
                                };
                    var data=JSON.stringify(dict);

                    $.ajax({
                        type:"POST",
                        url:"{{url_for('add_vp')}}",
                        data:data,
                        dataType:"json",
                        contentType:"application/json",
                        success:function(response){
                            console.log($(response));
                            var newURL ="{{ url_for('view_virtual_panels') }}?vp_id=" + response;
                            console.log(newURL)
                            console.log($('#main'))
                            $('#main').attr('action', newURL);
                            $('#main').attr('id', response);
                        },
                        error: function(response){
                            console.log($(response).responseText);
                            console.log('Error');}

                        });
                }
            }

            if ($(j.target).hasClass('glyphicon-new') || $(j.target).hasClass('glyphicon-new-selected') ) {
                $('.glyphicon.glyphicon-new-selected').removeClass('glyphicon-new-selected').addClass('glyphicon-new');
                $(this).addClass('glyphicon-new-selected').removeClass('glyphicon-new').blur();
            }
        });
    </script>

    <script>
        $(document).on('click', '.next-step, .prev-step', function (e) {
            var activeTab = $('.tab-pane.active');

            if(activeTab == $('#initialise'))
            {
                if($('#panel').val() == '__None' || $('#vpanelname').val().length == 0)
                {
                    console.log('empty field');
                    return;
                }
                else
                {
                    console.log('hello');
                    var vp_name = $('#vpanelname').val()
                    var dict = {
                                "vp_name": vp_name
                                };
                    var data=JSON.stringify(dict);

                    $.ajax({
                        type:"POST",
                        url:"{{url_for('add_vp')}}",
                        data:data,
                        dataType:"json",
                        contentType:"application/json",
                        success:function(response){
                            console.log($(response));
                            $('#main').attr('action', "{{ url_for('view_virtual_panels') }}?vp_id=" + response);
                            $('#main').attr('id', response);
                        },
                        error: function(response){
                            console.log($(response).responseText);
                            console.log('Error');}

                        });
                }
            }

            $('.glyphicon.glyphicon-new-selected').removeClass('glyphicon-new-selected').addClass('glyphicon-new');

            if ($(e.target).hasClass('next-step')) {
                var nextTab = activeTab.next('.tab-pane').attr('id');
                $('[href="#' + nextTab + '"]').addClass('glyphicon-new-selected').removeClass('glyphicon-new');
                $('[href="#' + nextTab + '"]').tab('show');
            }
            else {
                var prevTab = activeTab.prev('.tab-pane').attr('id');
                $('[href="#' + prevTab + '"]').addClass('glyphicon-new-selected').removeClass('glyphicon-new');
                $('[href="#' + prevTab + '"]').tab('show');
            }
        });
    </script>

    <script>
        $(document).on('change', '#panel', function(e){
            console.log('changed')
            $('#geneselector').children().remove()
            $('#loading').append("<div class=\"col-md-5\"></div><div class=\"loader col-md-2\"></div><div class=\"col-md-5\"></div>");

            var panel_id = $('#panel').val()
            console.log(panel_id)
            var dict = {
                        "panel": panel_id
                        };
            var data=JSON.stringify(dict);

            $.ajax({
                type:"POST",
                url:"{{url_for('select_vp_genes')}}",
                data:data,
                dataType:"json",
                contentType:"application/json",
                success:function(response){
                    $('#loading').children().remove()
                    $('#geneselector').append(response)
                },
                error: function(response){
                    console.log($(response).responseText);
                    console.log('Error');}

                });
        });
    </script>

    <script>
        $(document).on('click', '.label-success', function () {
            var geneName = $(event.target).attr('for');
            var geneId = $("#"+geneName).attr('name');
            $('#genelist').append("<button id=\"genebutton\" type=\"button\" class=\"btn btn-danger btn-md btngene\" data-name=\""+geneName+"\"data-id="+geneId+"><span class='glyphicon glyphicon-pencil'></span> "+geneName+"</button> ")
        });
    </script>

    <script>
        $(document).on('click', '#genebutton', function (request) {
            $('#regions').children().remove()
            $('#regions').append("<div class=\"col-md-5\"></div><div class=\"loader col-md-2\"></div><div class=\"col-md-5\"></div>");
            var element = $(request.currentTarget);
            var gene_id = $(element).attr('data-id');
            var panel_id = $('#panel').val()
            var dict = {
                "panel_id": panel_id,
                "gene_id": gene_id
            };
            var data=JSON.stringify(dict);

            $.ajax({
                type:"POST",
                url:"{{url_for('select_vp_regions')}}",
                data:data,
                dataType:"json",
                contentType:"application/json",
                success:function(response){
                    $('#regions').children().remove()
                    $('#regions').append(response)
                },
                error: function(response){
                    console.log($(response).responseText);
                    console.log('Error');}

                });
            });


    </script>

    <script>
        $(document).on('click', ".label-region", function (request) {
            console.log('button click');
            var obj = $(request.currentTarget);
            console.log($(request.currentTarget));
            if($(obj).attr('checked') == 'checked')
            {
                $(obj).removeAttr('checked');
                if($(".label-selectall").attr('checked') == 'checked')
                {
                    $(".label-selectall").attr('uncheck-all', 'false');
                    $(".label-selectall").trigger('click')
                }
            }
            else
            {
                $(obj).attr('checked', 'checked')
            }

        });
    </script>

    <script>

        $(document).on('click', ".label-selectall", function () {
            console.log($(".label-selectall").attr('checked'));

            if ($(".label-selectall").attr('uncheck-all') == 'false')//if one
            {
                $(".label-selectall").removeAttr('checked');
                $(".label-selectall").removeAttr('uncheck-all')
            }
            else if ($(".label-selectall").attr('checked') == 'checked') //if select all has been clicked off
            {
                console.log('goodbye');
                $(".label-selectall").removeAttr('checked'); //remove the checked attribute

                $(".label-region").each(function(i, obj)//loop through all elements with .label-region class
                {
                    if ($(obj).attr('checked') == 'checked')//if object is checked turn it off
                    {
                        $(obj).trigger('click');
                        console.log('was checked')
                    }
                    else//do nothing
                    {
                        console.log('already unchecked')
                    }
                });
            }
            else //if select all has been clicked on
            {
                $(".label-selectall").attr('checked', 'checked');//add checked attribute
                console.log('hello');

                $(".label-region").each(function(i, obj)//loop through all elements with .label-region class
                {
                    if ($(obj).attr('checked') == 'checked')//if object is selected do nothing
                    {
                        console.log('already checked')
                    }
                    else //click object to on
                    {
                        console.log('not checked');
                        $(obj).trigger('click')
                    }
                });

            }

        });
    </script>

    <script>

        $(document).ready(function () {

            $('[data-toggle="tooltip"]').tooltip();

            $("#genelabels").hide();

            // Add items to input field
            var eachline = '';
            $("#add").click(function () {

                $("#genelabels").show();
                var lines = $('#genes').val().split('\n');
                var lines2 = $('#listgenes').val().split('\n');

                for (var i = 0; i < lines.length; i++) {
                    if (lines[i] != '' && i + lines2.length < 11) {
                        eachline += lines[i] + '\n';
                    }
                }

                $("<h3><span class='label label-warning test'>" + lines + "</span></h3>").appendTo('#addhere');

                var TheTextBox = document.getElementById("listgenes");
                TheTextBox.value = TheTextBox.value + lines + ",";

                $('#genes').val('');
            });
        });
    </script>
    <script>
        $(function () {
            $("#genes").autocomplete({
                source: function (request, response) {
                    $.getJSON("{{url_for('autocomplete')}}", {
                        q: request.term, // in flask, "q" will be the argument to look for using request.args
                    }, function (data) {
                        response(data.matching_results); // matching_results from jsonify
                    });
                },
                minLength: 2,
                select: function (event, ui) {
                    console.log(ui.item.value); // not in your question, but might help later
                }
            });
        })
    </script>
    {% if delete == True %}
    <script type="text/javascript">
        $(document).ready(function () {

            $('#areyousure').modal('show');

        });
    </script>
    {% endif %}
</head>


<body>


<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button><!---->
            <a class="navbar-brand" href="{{ url_for('index') }}"><span class="glyphicon glyphicon-th-list"></span>
                PanelPal</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li><a href="{{ url_for('index') }}">Home</a></li>

                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                       aria-expanded="false">Projects <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="{{ url_for('view_projects') }}">View Projects</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="{{ url_for('add_projects') }}">Create Project</a></li>
                    </ul>
                </li>


                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                       aria-expanded="false">Panels <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="{{ url_for('view_panels') }}">View Panels</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="/panels/create">Create Panel</a></li>
                        <!--<li><a href="#">Create Panel From Panel App</a></li>-->
                        <!--<li role="separator" class="divider"></li>-->
                        <!--<li><a href="#">Export Panel</a></li>-->
                    </ul>
                </li>

                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                       aria-expanded="false">Virtual Panels <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="/virtualpanels">View Virtual Panels</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="/virtualpanels/create">Create a Virtual Panel</a></li>
                        <!--<li role="separator" class="divider"></li>-->
                        <!--<li><a href="#">Export Virtual Panel</a></li>-->
                    </ul>
                </li>
                {% if admin == True %}
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
                       aria-expanded="false">Admin <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="/admin/user">User Admin</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="/edit_permissions_admin">Permissions</a></li>
                        <!--<li role="separator" class="divider"></li>-->
                        <!--<li><a href="/virtualpanels/create">Create a Virtual Panel</a></li>-->
                        <!--<li role="separator" class="divider"></li>-->
                        <!--<li><a href="#">Export Virtual Panel</a></li>-->
                    </ul>
                </li>
                {% endif %}
                <!--<li class="dropdown">-->
                    <!--<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"-->
                       <!--aria-expanded="false">Preferred TX <span class="caret"></span></a>-->
                    <!--<ul class="dropdown-menu">-->
                        <!--<li><a href="">View Transcripts</a>-->
                        <!--<li role="separator" class="divider"></li>-->
                    <!--</ul>-->
                <!--</li>-->

                <!--<li class="dropdown">-->
                    <!--<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"-->
                       <!--aria-expanded="false">Polylists<span class="caret"></span></a>-->
                    <!--<ul class="dropdown-menu">-->
                        <!--<li><a href="">View Transcripts</a>-->
                        <!--<li role="separator" class="divider"></li>-->
                    <!--</ul>-->
                <!--</li>-->


                <li><a href="/api/spec.html"><span class="glyphicon glyphicon-cog"></span> API</a></li>
            </ul>

            <form class="navbar-form navbar-right" role="search">
                {% if logged_in == True %}
                    {% if admin == True %}
                        <a href="{{ url_for('logout')}}" class="btn btn-success" role="button">Logout <strong>{{ userid
                            }} </strong> </a>
                    {% else %}
                    <a href="{{ url_for('logout')}}" class="btn btn-success" role="button">Logout <strong>{{ userid
                                }}</strong></a>
                    {% endif %}
                {% else %}
                <a href="{{ url_for('login')}}" class="btn btn-primary" role="button">Login</a>
                {% endif %}
            </form>
            <!--<form class="navbar-form navbar-right" role="search">-->
  <!--<div class="form-group">-->
    <!--<input type="text" class="form-control" placeholder="Search">-->
  <!--</div>-->
  <!--<button type="submit" class="btn btn-default">Submit</button>-->
<!--</form>-->
        </div><!--/.nav-collapse -->
    </div>
</nav>

{% block popup %}
{% endblock %}

<div class="container theme-showcase" role="main">
    <div class="container">
        {% block content %}
        {% endblock %}
    </div>
</div>


</body>
</html>